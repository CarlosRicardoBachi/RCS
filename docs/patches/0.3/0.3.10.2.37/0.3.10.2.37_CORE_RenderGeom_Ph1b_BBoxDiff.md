# 0.3.10.2.37 — CORE — Render/Geom Phase 1b (bbox diff harness)

## Objetivo
Pasar de “tengo un bbox” a “sé **cuánto** difiere y dónde”.

En esta fase, el harness compara:
- **QtSvg observado**: bbox por alfa del render crudo (lo que *realmente salió* en píxeles).
- **Geometría**: bbox calculado por `svgelements` (si está instalado).

Resultado: un reporte reproducible que te dice PASS/WARN/FAIL y el *delta* de cada borde.

## Qué cambia
- Nuevo módulo `rcs/geom/bbox_compare.py` (sin dependencias):
  - Convierte `(x,y,w,h)` → `xyxy`.
  - Compara bbox Qt vs bbox geom con tolerancias.
  - Emite un dict serializable con: `status`, `max_abs_err_px`, `diff{dx0,dy0,dx1,dy1,...}`.

- Harness `python -m rcs.svg.render_debug`:
  - Calcula `raw_alpha_bbox` siempre (aunque no uses la UI).
  - Si hay bbox geom, calcula `bbox_compare` y agrega:
    - `status`: `PASS | WARN | FAIL | INVISIBLE | NO_GEOM`
    - `max_abs_err_px` y diffs por borde.
  - Escribe un reporte agregado: `_bbox_report.json`.

## Config
- Tolerancias:
  - `--bbox-tol` (PASS) / env `RCS_DBG_BBOX_TOL` (default 3.0)
  - `--bbox-warn` (WARN) / env `RCS_DBG_BBOX_WARN` (default 8.0)
- Reporte:
  - `--bbox-report` / env `RCS_DBG_BBOX_REPORT` (si no, usa `_bbox_report.json` en out)

## Importante
- Sigue siendo **opt-in**: no cambia el runtime de la app.
- Si `svgelements` no está instalado: status `NO_GEOM` (sin crash).
- Si QtSvg “no pinta nada”: status `INVISIBLE` (clave para el bug de render invisible).

## Archivos
- `rcs/geom/bbox_compare.py` (nuevo)
- `rcs/svg/render_debug.py` (upgrade)

## Prueba rápida (60s)
1) (Opcional) Instalar `svgelements`:
   - `python -m pip install svgelements`

2) Correr harness:
   - `python -m rcs.svg.render_debug componentes/figuras --recursive --modes raw --out _render_dbg`

3) Verificar:
- `_render_dbg/_bbox_report.json` existe.
- Para cada SVG hay un `status`.
- Probá a bajar tolerancias para “forzar” WARN/FAIL y confirmar que responde:
  - `--bbox-tol 1.0 --bbox-warn 2.0`

## DoD
- [ ] La app inicia normalmente (no hay cambios runtime).
- [ ] `render_debug` corre sin `svgelements` (genera reporte con `NO_GEOM`).
- [ ] Con `svgelements` instalado, el reporte incluye `geom_bbox_xyxy` y `diff`.
- [ ] Si un SVG sale invisible (alpha bbox None), queda marcado como `INVISIBLE`.
