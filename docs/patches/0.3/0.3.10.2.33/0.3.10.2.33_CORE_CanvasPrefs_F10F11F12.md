# [0.3.10.2.33] CORE — Preferencias del lienzo persistentes (F10/F11/F12 + scroll)

## Objetivo
Dar control **persistente** (en `rcs_settings.json`) sobre:
- Tamaño de página/canvas por defecto.
- Vista inicial exacta (centro + zoom) al abrir/crear proyecto.
- Rango de zoom (clamp máx y mín “fit”) con presets rápidos.
- Scrollbars horizontal/vertical (on/off) desde menú.

Todo esto sin romper el flujo actual: el proyecto sigue pudiendo cambiar su canvas con *Tamaño en mm…*, pero ahora podés definir un **default** reutilizable y una **vista** reproducible.

---

## Cambios visibles

### 1) F10 — “Página por defecto…”
- Abre un diálogo (mm) para **ancho/alto por defecto**.
- Aplica el tamaño al proyecto actual.
- Guarda el default en `rcs_settings.json`.
- Ese default se aplica automáticamente al iniciar RCS y al hacer **Archivo → Nuevo**.

### 2) F11 — “Guardar vista de inicio”
- Captura:
  - centro en coordenadas **canvas** (mm relativos al origen del canvas)
  - zoom actual
- Lo guarda en `rcs_settings.json`.
- Al abrir/crear proyecto, esa vista se aplica **después** del `fit` inicial y del `startup anchor`.

### 3) F12 — “Rango de zoom…”
- Menú contextual en cursor con presets:
  - 0.5× (menos zoom máximo y más “fit” mínimo)
  - 1.0× (default)
  - 1.5×
  - 2.0×
  - 3.0×
  - 4.0×
  - “Personalizado…”
- El factor ajusta:
  - `zoom_max = zoom_max_base * factor`
  - `zoom_min_dynamic = zoom_min_fit / factor`
- Se persiste en `rcs_settings.json`.

### 4) Menú Ver → Scroll del lienzo
- Toggles checkeables:
  - Horizontal
  - Vertical
- Persiste ambos flags en `rcs_settings.json`.

---

## Nuevas claves en `rcs_settings.json`
Dentro de `ui.canvas`:

```json
{
  "default_canvas_mm": [500, 300],
  "start_view": {
    "center_canvas": [250.0, 150.0],
    "zoom": 1.0
  },
  "zoom_range": 1.0,
  "scroll_h": false,
  "scroll_v": false
}
```

> `start_view` es opcional: si no existe, se usa el comportamiento normal.

---

## Variables de entorno (compatibilidad + debugging)
Se mantienen las anteriores, y se agregan/expanden:

- `RCS_CANVAS_DEFAULT_W_MM` / `RCS_CANVAS_DEFAULT_H_MM` (derivadas de `default_canvas_mm`)
- `RCS_CANVAS_START_VIEW` = `"cx,cy,zoom"` (derivada de `start_view`)
- `RCS_CANVAS_ZOOM_RANGE` (derivada de `zoom_range`)

Scrollbars:
- Nuevas:
  - `RCS_CANVAS_SCROLL_H` = `off|needed|on`
  - `RCS_CANVAS_SCROLL_V` = `off|needed|on`
- Legacy:
  - `RCS_CANVAS_SCROLLBARS` (aplica a ambos si no hay `*_H`/`*_V`).

---

## Archivos tocados
- `rcs/core/version.py`
- `rcs/core/settings.py`
- `rcs/ui/canvas_view.py`
- `rcs/ui/main_window.py`
- `rcs_settings.json`
- `docs/patches/index.md`
- `docs/CHANGELOG.md`
- `ai/context.json`
- `docs/checklist/CHECKLIST_0.3.10.2.33_CORE_CanvasPrefs_F10F11F12.md`

---

## Prueba rápida
1) Abrir RCS, mover/zoomear el canvas, centrar donde quieras.
2) F11 → cerrar RCS → abrir: debería iniciar en esa misma vista.
3) F12 → 2.0× → probar zoom máximo/mínimo.
4) Ver → Scroll del lienzo → habilitar vertical → debería aparecer scrollbar si hace falta.
5) F10 → poner 800×500 → Archivo → Nuevo: el proyecto nuevo debería nacer con 800×500.


---

## Checklist
- `docs/checklist/CHECKLIST_0.3.10.2.33_CORE_CanvasPrefs_F10F11F12.md`
