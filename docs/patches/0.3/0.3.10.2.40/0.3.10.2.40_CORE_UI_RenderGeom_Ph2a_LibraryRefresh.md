# 0.3.10.2.40 â€” CORE+UI â€” Render/Geom Phase 2a (NormalizeContract + thumbs mode) + Biblioteca Refresh

Fecha: 2026-01-24

## Objetivo
1) Consolidar un contrato reusable de normalizaciÃ³n de viewport SVG (truth) para que **QtSvg**, **svgelements** y futuro backend (Skia) hablen el mismo idioma.
2) Ampliar el harness para detectar el caso real: **canvas visible vs thumbs invisibles/distintos**, sin tocar el renderer principal.
3) Agregar botÃ³n ðŸ”„ en **Biblioteca** para re-escaneo manual del filesystem.

## Cambios principales

### CORE â€” NormalizaciÃ³n de viewport
- Nuevo mÃ³dulo: `rcs/geom/svg_viewport_normalize.py`
- API: `normalize_svg_viewport(svg_path) -> NormalizedViewport`
  - `doc_w`, `doc_h` (en px CSS)
  - `viewbox` (x,y,w,h) o None
  - `ppi` estimado (si hay unidades fÃ­sicas + viewBox)
  - `units` detectadas

### CORE â€” Harness: modo thumbs
- `rcs/svg/render_debug.py`
  - `--modes` ahora acepta: `raw,thumb,thumbs,canvas`
  - `thumbs` usa el pipeline real de la UI (`ThumbCache.render_svg_to_image`) para renderizar miniaturas.
  - El reporte incluye `meta.normalize` con el contrato de viewport.
  - ClasificaciÃ³n ampliada (sin romper compat del JSON previo):
    - `WARN_SMALL`, `WARN_RATIO`, `FAIL_ALIGN`, `INVISIBLE_QTSVG`, `NO_GEOM`, `PASS`

### UI â€” Biblioteca: botÃ³n ðŸ”„ Refrescar
- `rcs/ui/library_panel.py`
  - Header nuevo con tÃ­tulo + botÃ³n ðŸ”„
  - Al clickear:
    - Re-escanea filesystem (Ã¡rbol)
    - Recarga miniaturas
    - Preserva carpeta/selecciÃ³n best-effort
  - Nota: el `ThumbCache` usa `mtime_ns` en la clave, asÃ­ que SVG editado â‡’ thumb nueva tras refrescar.

## DoD rÃ¡pido
- `python -c "from rcs.core.version import APP_VERSION; print(APP_VERSION)"` â‡’ `0.3.10.2.40`
- `python -m rcs.svg.render_debug <svg-o-carpeta> --modes raw,thumbs`:
  - Si el canvas se ve pero la thumb no, debe marcar `INVISIBLE_QTSVG` o divergencia clara en bbox.
- Biblioteca: botÃ³n ðŸ”„ actualiza tree/thumbs sin reiniciar la app.
