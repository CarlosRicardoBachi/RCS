# 0.3.10.2.24 — CORE — Z-Order mínimo (capas)

## Objetivo
Poder manipular objetos superpuestos sin “pelearte” con el apilado, manteniendo un Z coherente y persistente por item.

---

## Cambios
### UI
- Nuevo menú **Objeto** con 4 acciones:
  - **Traer al frente** (`Ctrl+Shift+]`)
  - **Enviar al fondo** (`Ctrl+Shift+[`) 
  - **Subir un nivel** (`Ctrl+]`)
  - **Bajar un nivel** (`Ctrl+[`) 
- Tooltips + feedback en statusbar (ej: `Z: 12 → 13`).

### CORE / Canvas
- Cada `SceneObject` mantiene `z` **entero** y el `QGraphicsItem` usa `setZValue(z)`.
- Inserción: los items nuevos ya usan `project.next_z()` → **máximo + 1** (predecible, siempre arriba).
- Operaciones **Subir/Bajar 1**:
  - Implementadas como **swap mínimo** con el vecino inmediato (sin reordenar todo el scene).
  - Soporta selección múltiple como “bloque” (swap por bordes, preserva el orden relativo dentro de la selección).
- Persistencia:
  - `z` viaja en el proyecto (campo existente `SceneObject.z`).
  - Backward compatible: al cargar proyectos viejos cuyos objetos no tengan clave `z`, se asigna `z` por **orden de carga**.

### No cambia
- No toca render/thumbnails.
- No toca el sistema de estilos.
- No cambia el schema `.RCS` (se aprovecha `z` ya presente).

---

## DoD (Definition of Done)
Con 3 objetos superpuestos, podés:
1. Mandar uno al fondo → queda debajo.
2. Traerlo al frente → vuelve arriba.
3. Subir/Bajar un nivel → se ve el cambio.
4. Guardar → cerrar → abrir → el orden se conserva.

---

## Checklist (para este ZIP)
- [ ] `APP_VERSION` actualizado a `0.3.10.2.24`.
- [ ] Menú **Objeto** visible + acciones conectadas.
- [ ] Atajos no pisan los existentes.
- [ ] Statusbar muestra feedback útil.
- [ ] Persistencia: `z` se guarda y se restaura.
- [ ] Compat: proyecto sin `z` carga con orden estable (por inserción).
- [ ] `docs/patches/index.md` y `docs/CHANGELOG.md` actualizados.
- [ ] `ai/context.json` actualizado (versión + foco).

---

## Verificación rápida (≈ 30 segundos)
1. Insertá 3 SVGs y superponelos (movelos al mismo lugar).
2. Seleccioná el de abajo:
   - `Ctrl+Shift+]` → debería quedar arriba.
   - `Ctrl+Shift+[` → debería volver abajo.
3. Seleccioná uno del medio:
   - `Ctrl+]` y `Ctrl+[` → debería “subir/bajar” un paso.
4. Guardá el proyecto, cerrá RCS, abrilo de nuevo → el orden debe mantenerse.

---

## Archivos tocados
- `rcs/core/version.py`
- `rcs/core/models.py`
- `rcs/ui/canvas_view.py`
- `rcs/ui/main_window.py`
- `docs/patches/index.md`
- `docs/CHANGELOG.md`
- `ai/context.json`
