# 0.3.10.2.68 — HOTFIX GMPR Import (canvas sizing)

Fecha: 2026-02-04

## Problema

Al importar un `.GMPR`, el raster puede aparecer con **posición/tamaño incorrectos**.
En GMPR, (x,y) suelen estar en **mm respecto al SVG base**. Si el `Project.canvas_mm` queda en default,
el origen del canvas en escena cambia y el raster termina “teletransportado”.

## Objetivo

1) Inferir `canvas_mm` al importar GMPR para alinear coordenadas en mm.
2) Robustecer la interpretación de `sx/sy` del raster (mm/px vs factor relativo) sin romper compat.

## Cambios

### GMPR import: canvas_mm automático

- Se agrega `_infer_canvas_mm_from_gmpr(bundle, svg_path)`:
  - Primero busca `canvas_mm` en el bundle (y variantes comunes en `project/doc/meta/settings`).
  - Si no existe, deriva el tamaño desde el **SVG embebido** usando `normalize_svg_viewport()`.
- `gmpr_to_project()` aplica `prj.set_canvas_mm(w_mm, h_mm)` cuando se pudo inferir.

### GMPR import: heurística de escala

- `_gmpr_raster_transform_to_rcs_transform()` ahora detecta escalas absurdas:
  - Si `sx*s` / `sy*s` cae fuera de un rango razonable para mm/px, se interpreta como **factor relativo**.
  - Caso típico (mm/px) sigue igual.

## No cambia (a propósito)

- El SVG base del GMPR sigue siendo **preview de fondo** no seleccionable (no es un objeto editable todavía).
  Eso se trata en un fragmento posterior para no mezclar riesgos.

## Archivos tocados

- `rcs/core/gmpr_io.py`
- `rcs/core/version.py`
- `docs/CHANGELOG.md`
- `docs/patches/index.md`
- `docs/patches/0.3/0.3.10.2.68/0.3.10.2.68_HOTFIX_GMPR_CanvasSizing.md`
- `docs/checklist/CHECKLIST_0.3.10.2.68_HOTFIX_GMPR_CanvasSizing.md`

## Criterio de aceptación

- Importar GMPR: el raster aparece con **posición/tamaño coherentes** respecto al SVG embebido.
- No hay regresión: Biblioteca sigue funcionando y abre SVGs.
- Guardar GMPR no crashea y al reabrir mantiene el raster razonable (sin “teletransporte”).
