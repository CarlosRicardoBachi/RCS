# 0.3.10.2.38 — CORE — Render/Geom Phase 1c: BBox Regression Harness

## Objetivo
Convertir el harness de Render/Geom en una herramienta útil para **cazar casos rotos** y **detectar regresiones** sin tocar el runtime.

En Phase 1b ya teníamos `_bbox_report.json` (PASS/WARN/FAIL/INVISIBLE/NO_GEOM). En esta fase agregamos:
- ranking no-PASS ordenado por severidad + error
- baseline compare (regresión/mejora)
- comando `repro` por SVG para aislar el caso

## Qué cambia
### Harness (`python -m rcs.svg.render_debug`)
- Sigue generando `_bbox_report.json`.
- Nuevo: `_bbox_failures.json`
  - lista de casos **no-PASS** (WARN/FAIL/INVISIBLE) ordenados por severidad y `max_abs_err_px`
  - cada entrada incluye `repro` (comando CLI copiable)
- Nuevo (opcional): `_bbox_regressions.json`
  - se genera si pasás `--bbox-baseline <path>`
  - clasifica: `regressions`, `improvements`, `unchanged`, `new`, `missing`

### Nuevos flags
- `--bbox-top N` (default 25; `0` = todos)
- `--bbox-failures <path>` (opcional; default `_bbox_failures.json` en `--out`)
- `--bbox-baseline <path>` (opcional; compara contra un `_bbox_report.json` anterior)
- `--bbox-regress <path>` (opcional; default `_bbox_regressions.json` en `--out`)
- `--bbox-baseline-update` (opt-in: sobrescribe baseline con el reporte actual)
- `--bbox-include-no-geom` (incluye NO_GEOM en ranking; por defecto se excluye)

## Archivos tocados
- `rcs/svg/render_debug.py`
- `rcs/geom/bbox_report.py` (nuevo)
- `rcs/core/version.py`
- `docs/patches/index.md`
- `docs/CHANGELOG.md`
- `ai/context.json`

## Cómo probar rápido (60s)
1) Generar report + ranking:
```bat
python -m rcs.svg.render_debug .\assets\svg --recursive --out .\out_bbox
```
Verificá que existan en `out_bbox`:
- `_bbox_report.json`
- `_bbox_failures.json`
- `_summary.json`

2) Probar `repro`:
- Abrí `_bbox_failures.json`
- Copiá el campo `repro` de una entrada
- Pegalo y ejecutalo: debe generar outputs sólo para ese SVG sin crashear.

3) Baseline compare:
```bat
python -m rcs.svg.render_debug .\assets\svg --recursive --out .\out_bbox_2 --bbox-baseline .\out_bbox\_bbox_report.json
```
Debe generarse `out_bbox_2\_bbox_regressions.json`.

## DoD
- El harness corre igual que antes (no rompe flags previos).
- Se genera `_bbox_failures.json` con `repro` por entrada.
- Con `--bbox-baseline` se genera `_bbox_regressions.json`.
- No se toca runtime de la app (solo tooling).

## Checklist
- `docs/checklist/CHECKLIST_0.3.10.2.38_CORE_RenderGeom_Ph1c_BBoxRegressionHarness.md`
