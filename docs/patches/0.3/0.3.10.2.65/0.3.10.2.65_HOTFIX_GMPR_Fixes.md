# 0.3.10.2.65 — HOTFIX GMPR (library + escala raster)

Fecha: 2026-02-02

## Objetivo

Corregir dos regresiones críticas al importar/guardar GMPR:

1) Importar un .GMPR no debe “secuestrar” la biblioteca de SVG (panel Bibliotecas).
2) Los rasters importados desde GMPR deben conservar tamaño/posición correctos (escala sx/sy mm/px + s).

Además, se ajusta la UI para que GMPR quede explícitamente como “Importar”.

## Cambios

### GMPR: biblioteca de SVG (components_root)

- `Project.components_root_path()` ahora resuelve bibliotecas relativas:
  - Si el proyecto es .GMPR: relativo al `cwd` (carpeta de trabajo del usuario).
  - Si el proyecto es .RCS (legacy): relativo al directorio del archivo.

- `gmpr_to_project()` deja de sobrescribir `components_root` a una carpeta “components” dentro del GMPR.

Resultado: al abrir/importar un GMPR, el panel Bibliotecas sigue apuntando a `./componentes` (o lo que el usuario haya configurado).

### GMPR: escala de raster (sx/sy mm/px + s)

- La carga de rasters interpreta el `transform` de GMPR como:
  - `x,y` en mm
  - `sx,sy` como mm/px (escala absoluta)
  - `s` como factor uniforme opcional
  - `rot` o `rot_deg` como rotación (grados)

- El guardado/actualización de transforms escribe `sx,sy` como mm/px (escala absoluta) para compatibilidad con Rustic Creator.
  - Si el JSON ya tiene `s`, se intenta preservarlo como factor uniforme.
  - Si no se puede (no-uniform), se encoda la escala en `sx/sy` y se fuerza `s=1.0`.

Incluye heurística de compatibilidad con GMPR escritos por RCS antiguo (rot_deg sin rot y sin s).

### UI

- Menú **Archivo**:
  - **Importar SVG…** (Ctrl+O): inserta un SVG externo como un nuevo objeto.
  - **Importar GMPR…** (Ctrl+I): carga un GMPR y reconstruye el lienzo.

## Archivos tocados

- `rcs/core/models.py`
- `rcs/core/gmpr_io.py`
- `rcs/ui/main_window.py`
- `rcs/core/version.py`
- `docs/CHANGELOG.md`
- `docs/patches/index.md`
