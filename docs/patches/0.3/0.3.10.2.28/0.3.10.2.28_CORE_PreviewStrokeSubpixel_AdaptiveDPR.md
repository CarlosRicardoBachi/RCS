# 0.3.10.2.28 — CORE — Preview SVG: subpixel + DPR adaptivo (stroke/outline estables al escalar)

## Objetivo
Corregir el “engorde” del trazo/halo en el **preview raster** de SVG cuando un objeto se escala (muy evidente al agrandar 5×, 10×, etc.).

El bug raíz era una combinación de 2 cosas:
1. Se compensaba la escala con `stroke_px = round((stroke_thick * dpr) / obj_scale)`.
2. Luego se aplicaba un **clamp** a `>= 1px` (porque el pipeline previo esperaba enteros). Cuando el valor real debía ser menor a 1px (subpixel), el clamp forzaba 1px y al volver a escalar el item terminaba viéndose más grueso.

## Cambios
- **Subpixel stroke (canvas preview):** el trazo ahora se calcula como *float* en px físicos (`stroke_px = (stroke_thick * dpr) / obj_scale`) sin clamp a int>=1.
- **DPR adaptivo por buckets:** si el objeto está muy escalado y el grosor interno caería a “casi 0px”, se sube el DPR interno (en saltos tipo 1/2/4/8/16) para conservar calidad y evitar irregularidades de raster.
- **Outline más estable:** el halo (outline) sigue usando `dilate` y requiere entero, pero ahora se beneficia del DPR adaptivo antes de redondear, reduciendo “saltos” visibles.

## Tuning (opcional por variables de entorno)
- `RCS_CANVAS_PREVIEW_DPR_MAX` (default: `16`): tope del DPR interno para previews en canvas.
- `RCS_CANVAS_PREVIEW_MIN_THICK_PX` (default: `0.85`): mínimo de px físicos en el raster interno para que QtSvg no “se coma” el trazo/halo.
- `RCS_CANVAS_PREVIEW_DPR_BUCKETS` (default: `1,2,3,4,6,8,12,16`): buckets permitidos.

## Archivos tocados
- `rcs/ui/canvas_view.py`
- `rcs/core/version.py`
- `docs/CHANGELOG.md`
- `docs/patches/index.md`
- `ai/context.json`

## Pruebas manuales sugeridas
1. Abrir un proyecto con SVG con stroke visible.
2. En canvas:
   - Seleccionar objeto.
   - Escalar 2×, 5×, 10×.
   - Verificar que el **grosor del trazo/halo** se mantiene visualmente estable (no engorda) mientras el objeto crece.
3. Repetir con escalado no uniforme (X distinto de Y) y rotación.
4. En “Ver → Preview: Trazo/Outline”, cambiar grosores y repetir el test.

## Checklist
- [x] No se removió funcionalidad existente.
- [x] Cambio encapsulado (solo preview SVG en canvas).
- [x] Version bump + registro en `CHANGELOG` + `docs/patches/index`.
- [x] `ai/context.json` actualizado.
