# Patch 0.3.10.2.9 (CORE) — PreviewStyle unificado (canvas + thumbs)

## Objetivo

Eliminar la divergencia visual entre:
- **Canvas** (overlay de selección / preview en lienzo)
- **Miniaturas** (ThumbCache)

Y cerrar el agujero típico de Qt6/PySide6:
- `QImage.bits()` puede devolver `memoryview` (sin `.setsize()`).

## Cambios técnicos

### 1) Nuevo módulo: `rcs/svg/preview_style.py`
- Implementa un pipeline único:
  - `extract_alpha8()` (Qt5/Qt6-safe)
  - `dilate_alpha()` (vecindad-8, composition Lighten)
  - `tint_from_alpha8()` (tinta ARGB premultiplied)
  - `stylize_preview_image()` (ink + outline, con fallback si queda invisible)
- Firma de estilo (`preview_style_signature`) para invalidación de cache.

### 2) Canvas delega a PreviewStyle
Archivo: `rcs/ui/canvas_view.py`
- `_extract_alpha8`, `_tint_from_alpha8`, `_dilate_alpha`, `_alpha_bbox`,
  `_preview_colors_for_theme`, `_stylize_preview_image` → delegan a `preview_style`.
- `_add_interior_hit_fill`: se protege `.setsize()` para compatibilidad Qt6.

### 3) Thumbs delega a PreviewStyle + cache key robusta
Archivo: `rcs/svg/thumbs.py`
- Stylize de miniaturas unificado (`pv.stylize_preview_image(kind="thumb")`).
- Cache key ahora incluye:
  - `thumb-v3`
  - `theme_id` (env: `RCS_THUMB_THEME` / `RCS_PREVIEW_THEME`)
  - `stroke/outline thickness` (env canon: `RCS_PREVIEW_*`, fallback `RCS_THUMB_*`)
  - `render_scale` (env: `RCS_THUMB_RENDER_SCALE`)

## Variables de entorno relevantes

- `RCS_PREVIEW_STROKE_THICK`, `RCS_PREVIEW_OUTLINE_THICK` (canónicas, afectan canvas+thumbs)
- `RCS_CANVAS_STROKE_THICK`, `RCS_CANVAS_OUTLINE_THICK` (fallback canvas)
- `RCS_THUMB_STROKE_THICK`, `RCS_THUMB_OUTLINE_THICK` (fallback thumbs)
- `RCS_THUMB_RENDER_SCALE` (thumbs)
- `RCS_PREVIEW_THEME` / `RCS_THUMB_THEME` (opcional; default `"dark"`)

## Verificación

Checklist: `CHECKLIST_0.3.10.2.9.md`
